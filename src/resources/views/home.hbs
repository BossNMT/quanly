{{> header}}
{{#if token}}
<script type="text/javascript">
//---Fucvtion Cookie W3sacholl
    function setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        let expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
//---set cookie
    const token = '{{token}}'
    setCookie('token', token, 1)
</script>
{{/if}}

<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>

<div class="home_content">
    <div class="text">
        <div class="header__dashboard">
            <div class="admin">
                <h6>Admin</h6>
            </div>
        </div>

        <div class="container__dashboard">
            <div class="solieu">
                <div class="solieu__homnay">
                    <div class="icon">
                        <i style="color: #4f808c;" class='bx bxs-calendar-alt' ></i>
                    </div>
                    <div class="dulieu">
                        <span class="dulieu__loaidulieu">Số Hóa Đơn Ngày Hôm Nay:</span><span class="dulieu__conso">{{countHomNay}}</span>
                    </div>
                </div>

                <div class="solieu__homnay">
                    <div class="icon">
                        <i style="color: #3c9766;" class='bx bx-calendar-check'></i>
                    </div>
                    <div class="dulieu">
                        <span class="dulieu__loaidulieu">Tổng Tiền Hôm Nay:</span><span id="tongtienhomnay" class="dulieu__conso"></span>
                    </div>
                </div>

                <div class="solieu__homnay">
                    <div class="icon">
                        <i style="color: #cf3c40;" class='bx bxs-calendar-x' ></i>
                    </div>
                    <div class="dulieu">
                        <span class="dulieu__loaidulieu">Tiền Nợ Hôm Nay:</span><span id="tiennohomnay" class="dulieu__conso"></span>
                    </div>
                </div>
            </div>

            <div id="chartContainer"></div>
        </div>
    </div>
</div>


<script>
window.onload = function () {

    function totalMoneyT1(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT1}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT1}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
        
    }

    function totalMoneyT2(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT2}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT2}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT3(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT3}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT3}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT4(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT4}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT4}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT5(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT5}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT5}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT6(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT6}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT6}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT7(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT7}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT7}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT8(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT8}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT8}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT9(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT9}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT9}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT10(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT10}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT10}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT11(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT11}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT11}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }

    function totalMoneyT12(kieuthanhtoan) {
        var money = 0;
        if (kieuthanhtoan == 'TỔNG') {
            {{#each moneyT12}}
            money += Number({{this.money}})
            {{/each}}
            return money
        } else {
            {{#each moneyT12}}
            if ('{{this.phuongthuc}}' == 'NỢ') {
                money += Number({{this.money}})
            }
            {{/each}}
            return money
        }
    }


    var chart = new CanvasJS.Chart("chartContainer", {
        animationEnabled: true,
        title:{
            text: "Biểu Đồ Hóa Đơn 2021"
        },	
        axisY: {
            title: "Số Hóa Đơn",
            titleFontColor: "#4F81BC",
            lineColor: "#4F81BC",
            labelFontColor: "#4F81BC",
            tickColor: "#4F81BC"
        },
        axisY2: {
            title: "Số Tiền (VNĐ)",
            titleFontColor: "#C0504E",
            lineColor: "#C0504E",
            labelFontColor: "#C0504E",
            tickColor: "#C0504E"
        },	
        toolTip: {
            shared: true
        },
        legend: {
            cursor:"pointer",
            itemclick: toggleDataSeries
        },
        data: [{
            type: "column",
            name: "Số Hóa Đơn",
            legendText: "Số Hóa Đơn",
            showInLegend: true, 
            dataPoints:[
                { label: "Tháng 1", y: {{countT1}} },
                { label: "Tháng 2", y: {{countT2}} },
                { label: "Tháng 3", y: {{countT3}} },
                { label: "Tháng 4", y: {{countT4}} },
                { label: "Tháng 5", y: {{countT5}} },
                { label: "Tháng 6", y: {{countT6}} },
                { label: "Tháng 7", y: {{countT7}} },
                { label: "Tháng 8", y: {{countT8}} },
                { label: "Tháng 9", y: {{countT9}} },
                { label: "Tháng 10", y: {{countT10}} },
                { label: "Tháng 11", y: {{countT11}} },
                { label: "Tháng 12", y: {{countT12}} }
            ]
        },
        {
            type: "column",
            name: "Tổng Số Nợ",
            legendText: "Tổng Số Nợ",
            axisYType: "secondary",
            showInLegend: true, 
            dataPoints:[
                { label: "Tháng 1", y: totalMoneyT1('NỢ') },
                { label: "Tháng 2", y: totalMoneyT2('NỢ') },
                { label: "Tháng 3", y: totalMoneyT3('NỢ') },
                { label: "Tháng 4", y: totalMoneyT4('NỢ') },
                { label: "Tháng 5", y: totalMoneyT5('NỢ') },
                { label: "Tháng 6", y: totalMoneyT6('NỢ') },
                { label: "Tháng 7", y: totalMoneyT7('NỢ') },
                { label: "Tháng 8", y: totalMoneyT8('NỢ') },
                { label: "Tháng 9", y: totalMoneyT9('NỢ') },
                { label: "Tháng 10", y: totalMoneyT10('NỢ') },
                { label: "Tháng 11", y: totalMoneyT11('NỢ') },
                { label: "Tháng 12", y: totalMoneyT12('NỢ') }
            ]
        },
        {
            type: "column",	
            name: "Tổng Số Thanh Toán",
            legendText: "Tổng Số Thanh Toán",
            axisYType: "secondary",
            showInLegend: true,
            dataPoints:[
                { label: "Tháng 1", y: totalMoneyT1('TỔNG') },
                { label: "Tháng 2", y: totalMoneyT2('TỔNG') },
                { label: "Tháng 3", y: totalMoneyT3('TỔNG') },
                { label: "Tháng 4", y: totalMoneyT4('TỔNG') },
                { label: "Tháng 5", y: totalMoneyT5('TỔNG') },
                { label: "Tháng 6", y: totalMoneyT6('TỔNG') },
                { label: "Tháng 7", y: totalMoneyT7('TỔNG') },
                { label: "Tháng 8", y: totalMoneyT8('TỔNG') },
                { label: "Tháng 9", y: totalMoneyT9('TỔNG') },
                { label: "Tháng 10", y: totalMoneyT10('TỔNG') },
                { label: "Tháng 11", y: totalMoneyT11('TỔNG') },
                { label: "Tháng 12", y: totalMoneyT12('TỔNG') }
            ]
        }]
    });
    chart.render();

    function toggleDataSeries(e) {
        if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
            e.dataSeries.visible = false;
        }
        else {
            e.dataSeries.visible = true;
        }
        chart.render();
    }
}
</script>

<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<script>
    const tongtienElement = document.querySelector('#tongtienhomnay')
    const tiennoElement = document.querySelector('#tiennohomnay')

    var moneyTotal = 0;
    var moneyNo = 0;
    {{#each moneyHomNay}}
    moneyTotal += Number({{this.money}})
    if ('{{this.phuongthuc}}' == 'NỢ') {
        moneyNo += Number({{this.money}})
    }
    {{/each}}

    function formatMoney(str) {
        return str.toString().split('').reverse().reduce((prev, next, index) => {
            return ((index % 3) ? next : (next + ',')) + prev
        })
    }

    tongtienElement.innerHTML = formatMoney(moneyTotal)
    tiennoElement.innerHTML = formatMoney(moneyNo)

</script>

